---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(svglite)
library(dplyr)
library(RColorBrewer) 
library(scales)
library(colorspace)
library(broom)
data <- read.csv("spmv.csv")
v_data  <- read.csv("spmv_validate.csv")

#data <- data %>% 
    #filter(core <=16) %>%
      #filter(core%%2 ==0) %>%
  #filter(alg=="tile-avx") %>%
  #filter(ratio <1) %>%
    #filter(Stack.Size %in% c("1 MB", NA)) %>%
  #filter(size == 1000000) %>%
  #arrange(t) 

#data$size=as.factor(data$size)
data$shape=factor(data$shape, levels=unique(data$shape[order(data$size)]))
data$core=as.factor(data$core)
data <- data %>% mutate(N = i*j*k)
data$density=as.factor(data$density)
data$N=as.factor(data$N)

data$norm_N=scale(data$N)
data$norm_time=scale(data$time)
data$norm_density=scale(data$density)


colourCount = length(unique(data$core))
getPalette = colorRampPalette(brewer.pal(8, "Spectral"))

c=darken(getPalette(colourCount), amount = 0.08)
c=desaturate(c, amount = -0.4)
show_col(c)

image=v_data %>%
  ggplot( aes(x=N, y=time,color=density )) +
  geom_point()+
  geom_line()+
  #geom_bar(stat="identity", position=position_dodge())+
  #scale_color_manual(values=c) +
  #scale_x_continuous(name="Number of cores") +
  scale_y_continuous(name="log(time)",breaks = scales::pretty_breaks(n = 10)) 
image
ggsave(file="FLOP1x2.svg", plot=image, width=10, height=8)

model=lm(time~N*density*shape, data=data)
anova(model)
summary(model)
new <- data.frame(N = v_data$N, density=v_data$density)
v_data$predict_time = predict(model,new)
t.test(v_data$time, v_data$predict_time, paired = TRUE, alternative = "two.sided")

model.diag.metrics <- augment(model)
ggplot(model.diag.metrics, aes(norm_N,norm_time)) +
  geom_point() +
  stat_smooth(method = lm, se = FALSE) +
  geom_segment(aes(xend = norm_N, yend = .fitted), color = "red", size = 0.3)
par(mfrow = c(2, 2))
plot(model)
```

```{r}
plot(log(time)~log(N), data = data)
abline(model)

ggplot(data, aes(x = N, y = time, colour = density)) +
  geom_point()


pred.int <- predict(model, interval = "prediction")
mydata <- cbind(data, pred.int)

p <- ggplot(mydata, aes(N, time)) +
  geom_point() +
  stat_smooth(method = lm)
# 3. Add prediction intervals
p + geom_line(aes(y = lwr), color = "red", linetype = "dashed")+
    geom_line(aes(y = upr), color = "red", linetype = "dashed")
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r }
data <- read.csv("all.csv")


data <- data %>% 
  #filter(ratio == 1) %>%
    filter(Algorithm %in% c("Parallel 1", "Parallel 3", "Parallel 4", "Sequential")) %>%

  filter(Order=="random") %>%
  arrange(Number.of.cores) 

#data$Number.of.cores=as.factor(data$Number.of.cores)
data$Algorithm=as.factor(data$Algorithm)

colourCount = length(unique(data$Algorithm))
getPalette = colorRampPalette(brewer.pal(8, "Spectral"))

c=darken(getPalette(colourCount), amount = 0.08)
c=desaturate(c, amount = -0.4)
show_col(c)

image=data %>%
  ggplot( aes(x=Number.of.cores, y=Execution.time, group=Algorithm, color=Algorithm )) +
    geom_line() +geom_point()+
  scale_color_manual(values=c) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 20)) 
image
ggsave(file="rnd.svg", plot=image, width=10, height=8)

```

```{r }
data <- read.csv("all.csv")


data <- data %>% 
  #filter(ratio == 1) %>%
    filter(Algorithm %in% c("Parallel 1", "Parallel 3", "Parallel 4", "Sequential")) %>%

  filter(Order=="ascending") %>%
  arrange(Number.of.cores) 

#data$Number.of.cores=as.factor(data$Number.of.cores)
data$Algorithm=as.factor(data$Algorithm)

colourCount = length(unique(data$Algorithm))
getPalette = colorRampPalette(brewer.pal(8, "Spectral"))

c=darken(getPalette(colourCount), amount = 0.08)
c=desaturate(c, amount = -0.4)
show_col(c)

image=data %>%
  ggplot( aes(x=Number.of.cores, y=Execution.time, group=Algorithm, color=Algorithm )) +
    geom_line() +geom_point()+
  scale_color_manual(values=c) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 20)) 
image
ggsave(file="asc.svg", plot=image, width=10, height=8)

```

```{r }
data <- read.csv("all.csv")


data <- data %>% 
  #filter(ratio == 1) %>%
  filter(Algorithm %in% c("Parallel 1", "Parallel 3", "Parallel 4", "Sequential")) %>%
  filter(Order=="descending") %>%
  arrange(Number.of.cores) 

#data$Number.of.cores=as.factor(data$Number.of.cores)
data$Algorithm=as.factor(data$Algorithm)

colourCount = length(unique(data$Algorithm))
getPalette = colorRampPalette(brewer.pal(8, "Spectral"))

c=darken(getPalette(colourCount), amount = 0.08)
c=desaturate(c, amount = -0.4)
show_col(c)

image=data %>%
  ggplot( aes(x=Number.of.cores, y=Execution.time, group=Algorithm, shape=Algorithm, color=Algorithm )) +
    geom_line() +geom_point() +
  scale_color_manual(values=c) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 20)) 
image
ggsave(file="desc.svg", plot=image, width=10, height=8)

```

```{r }
data <- read.csv("all.csv")


data <- data %>% 
  #filter(ratio == 1) %>%
  filter(Algorithm %in% c("Parallel 1", "Parallel 2")) %>%
  arrange(Number.of.cores) 

#data$Number.of.cores=as.factor(data$Number.of.cores)
data$Algorithm=as.factor(data$Algorithm)

colourCount = length(unique(data$Algorithm))
getPalette = colorRampPalette(brewer.pal(8, "Spectral"))

c=darken(getPalette(6), amount = 0.08)
c=desaturate(c, amount = -0.4)
show_col(c)

image=data %>%
  ggplot( aes(x=Number.of.cores, y=Execution.time,color=interaction(Algorithm, Order),shape=interaction(Algorithm, Order) ,group=interaction(Algorithm, Order))) +
    geom_line() + geom_point() +
  scale_color_manual(values=c) +
  scale_x_continuous(breaks = scales::pretty_breaks(n = 20))
image
ggsave(file="a1_a2.svg", plot=image, width=10, height=8)

```
